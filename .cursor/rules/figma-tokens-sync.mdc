---
description: Workflow for syncing Figma design tokens (radius, spacing, colors) to CSS variables
globs: 
alwaysApply: false
---

# Figma Design Tokens Sync Workflow

This rule guides AI to sync Figma design tokens (radius, spacing, colors) to CSS variables in the codebase, ensuring design system consistency.

## When This Rule Applies

Trigger this workflow when:
- "Sync Figma tokens to code"
- "Update the fundamentals from Figma"
- "The design system changed in Figma"
- "Update CSS variables from Figma"
- Designer mentions radius, spacing, or color token changes

## Why rem Over px?

**Accessibility**: `rem` units respect user browser font size preferences. Users who set larger default fonts (e.g., for vision impairment) benefit from `rem`-based layouts that scale proportionally.

**Conversion formula**: `rem = px ÷ 16` (standard browser base font size)

| px | rem |
|----|-----|
| 4px | 0.25rem |
| 6px | 0.375rem |
| 8px | 0.5rem |
| 10px | 0.625rem |
| 12px | 0.75rem |
| 14px | 0.875rem |
| 16px | 1rem |
| 20px | 1.25rem |
| 24px | 1.5rem |
| 32px | 2rem |
| 40px | 2.5rem |
| 48px | 3rem |

## Workflow Steps

### Step 1: Extract Figma Variables

Use the Figma MCP to fetch design tokens from any node in the file:

```
Tool: get_variable_defs (server: user-Figma Online)
Parameters:
  - fileKey: extracted from Figma URL
  - nodeId: any node ID from the file (e.g., "3004:5708")
  - clientLanguages: "typescript"
  - clientFrameworks: "react,nextjs"
```

This returns all variables used in the design, including:
- `rounded-*` - border radius values
- `xs`, `sm`, `md`, `lg`, `xl` - spacing values
- Color tokens

### Step 2: Identify Radius Tokens

From the response, extract radius-related variables:

```json
{
  "rounded-lg": "12",
  "rounded-2xl": "32",
  "rounded-3xl": "32",
  "rounded-full": "9999",
  "radius": "16"
}
```

### Step 3: Convert px to rem

Apply the conversion formula for each value:

| Figma Variable | px Value | rem Value |
|----------------|----------|-----------|
| `rounded-lg` | 12px | 0.75rem |
| `rounded-xl` | 16px | 1rem |
| `rounded-2xl` | 32px | 2rem |
| `rounded-3xl` | 32px | 2rem |

### Step 4: Update globals.css

Update the `@theme inline` block in `apps/web/src/styles/globals.css`:

**Location**: Lines ~266-272 (inside `@theme inline { }`)

**Before** (calc-based):
```css
--radius-sm: calc(var(--radius) - 4px);
--radius-md: calc(var(--radius) - 2px);
--radius-lg: var(--radius);
--radius-xl: calc(var(--radius) + 4px);
--radius-2xl: calc(var(--radius) + 8px);
--radius-3xl: calc(var(--radius) + 12px);
--radius-4xl: calc(var(--radius) + 16px);
```

**After** (direct Figma values in rem):
```css
/* Synced from Figma: <fileKey> on <date> */
--radius-sm: 0.375rem;  /* 6px */
--radius-md: 0.5rem;    /* 8px */
--radius-lg: 0.75rem;   /* 12px - Figma: rounded-lg */
--radius-xl: 1rem;      /* 16px */
--radius-2xl: 2rem;     /* 32px - Figma: rounded-2xl */
--radius-3xl: 2rem;     /* 32px - Figma: rounded-3xl */
--radius-4xl: 2.5rem;   /* 40px */
```

### Step 5: Verify Component Usage

Check that shadcn components use the correct Tailwind radius classes:

| Component | Figma Design | Tailwind Class |
|-----------|--------------|----------------|
| Button | `rounded-lg` (12px) | `rounded-lg` |
| Card | `rounded-3xl` (32px) | `rounded-3xl` |
| Input | `rounded-md` (8px) | `rounded-md` |
| Badge | `rounded-lg` (12px) | `rounded-lg` |

Components should use semantic Tailwind classes (e.g., `rounded-lg`), NOT hardcoded values (e.g., `rounded-[12px]`).

### Step 6: Type-check and Test

```bash
yarn workspace @safe-global/web type-check
```

Verify visually in Storybook:
```bash
yarn workspace @safe-global/web storybook
```

## Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│ Figma Design System                                             │
│ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐                │
│ │ rounded-lg  │ │ rounded-2xl │ │ rounded-3xl │                │
│ │ 12px        │ │ 32px        │ │ 32px        │                │
│ └─────────────┘ └─────────────┘ └─────────────┘                │
└────────────────────────┬────────────────────────────────────────┘
                         │ get_variable_defs (MCP)
                         │ px ÷ 16 = rem
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│ globals.css (@theme inline)                                     │
│ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐                │
│ │ --radius-lg │ │--radius-2xl │ │--radius-3xl │                │
│ │ 0.75rem     │ │ 2rem        │ │ 2rem        │                │
│ └─────────────┘ └─────────────┘ └─────────────┘                │
└────────────────────────┬────────────────────────────────────────┘
                         │ Tailwind v4 @theme
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│ Tailwind Utility Classes                                        │
│ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐                │
│ │ rounded-lg  │ │ rounded-2xl │ │ rounded-3xl │                │
│ └─────────────┘ └─────────────┘ └─────────────┘                │
└────────────────────────┬────────────────────────────────────────┘
                         │ Used in components
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│ shadcn/ui Components                                            │
│ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐                │
│ │ Button      │ │ Card        │ │ Input       │                │
│ │ rounded-lg  │ │ rounded-3xl │ │ rounded-md  │                │
│ └─────────────┘ └─────────────┘ └─────────────┘                │
└─────────────────────────────────────────────────────────────────┘
```

## File Locations

| Purpose | File Path |
|---------|-----------|
| CSS Variables | `apps/web/src/styles/globals.css` |
| Button Component | `apps/web/src/components/ui/button.tsx` |
| Card Component | `apps/web/src/components/ui/card.tsx` |
| Input Component | `apps/web/src/components/ui/input.tsx` |

## Common Figma Variable Patterns

From the Obra shadcn-ui community file:

**Radius tokens**:
- `rounded-lg` → used for buttons, badges, inputs
- `rounded-2xl` / `rounded-3xl` → used for cards, containers
- `rounded-full` → used for avatars, circular elements

**Spacing tokens**:
- `xs` = 8px → 0.5rem
- `sm` = 12px → 0.75rem
- `md` = 16px → 1rem
- `lg` = 20px → 1.25rem
- `xl` = 24px → 1.5rem

## Validation Checklist

Before completing:
- [ ] All Figma radius values extracted via `get_variable_defs`
- [ ] px values converted to rem (px ÷ 16)
- [ ] `globals.css` updated with direct rem values
- [ ] Components use semantic Tailwind classes (not hardcoded values)
- [ ] Type-check passes
- [ ] Visual verification in Storybook

## Troubleshooting

**Components don't update after changing CSS variables:**
- Ensure you're editing the `@theme inline` block, not `:root`
- Check that component uses Tailwind class (e.g., `rounded-lg`) not custom class
- Hard refresh browser/Storybook

**Figma values don't match expected:**
- Re-run `get_variable_defs` to get fresh values
- Check if designer updated the Figma file
- Verify you're looking at the correct Figma node/page

## Common Mistakes to Avoid

### 1. Editing components instead of CSS variables
**Wrong approach:**
```tsx
// Hardcoding radius in button.tsx
className="rounded-xl ..."  // Changed from rounded-md
```

**Correct approach:**
```css
/* Update globals.css */
--radius-lg: 0.75rem;  /* 12px */
```
Then the component's existing `rounded-lg` class automatically gets the new value.

### 2. Using px instead of rem
**Wrong:**
```css
--radius-lg: 12px;
```

**Correct:**
```css
--radius-lg: 0.75rem;  /* 12px - accessible, scales with user preferences */
```

### 3. Not checking existing CSS variable system
Before making ANY changes:
1. Read `globals.css` to understand the `@theme inline` block
2. Understand how `--radius-*` maps to `rounded-*` Tailwind classes
3. Only then update the CSS variables

### 4. Forgetting to run this workflow BEFORE component implementation
**Order of operations:**
1. **FIRST**: Sync Figma tokens → CSS variables (this workflow)
2. **THEN**: Implement components using `figma-to-shadcn` workflow

If you implement components first, you'll hardcode values that should come from CSS variables.

### 5. Guessing component props instead of extracting them
**Wrong approach:**
```tsx
<Button size="sm">        // Assumed small because it "looked small"
<Input variant="outline"> // Guessed based on appearance
<Avatar size="sm">        // Guessed without checking properties
```

**Correct approach:**
1. Check component properties in Figma (variant, size) - these are exposed in shadcn libraries
2. Use property values directly as props
3. Don't measure pixels - the library defines sizes
4. Only add props that Figma explicitly shows in the properties panel

**This applies to ALL components, not just buttons.**

## Integration with figma-to-shadcn Workflow

This workflow should be run **before** the `figma-to-shadcn` workflow when:
- Starting a new Figma implementation
- Designer mentions "updated the design system"
- Components look different than Figma after implementation

The `figma-to-shadcn` workflow will prompt you to check tokens if mismatches are detected.
